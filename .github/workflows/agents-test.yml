name: ğŸ¤– Agents Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    # Run tests weekly on Sundays at 2 AM UTC
    - cron: '0 2 * * 0'

jobs:
  validate-agents:
    name: Validate Agent Prompts
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        agent: [SENTINEL, BOLT, ATLAS, BUDDHA, HUNTER, PICASSO, SHTEF, DOCKER, KUBERNETES, DATABASE, CICD, MONITORING, API, MOBILE, TESTING]
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ” Validate Agent Structure
      run: |
        echo "ğŸ¤– Validating ${{ matrix.agent }} agent..."
        
        # Check if agent file exists
        if [ ! -f "${{ matrix.agent }}.md" ]; then
          echo "âŒ Agent file ${{ matrix.agent }}.md not found"
          exit 1
        fi
        
        echo "âœ… Agent file exists"
        
        # Check required sections
        required_sections=(
          "You are"
          "Your mission is to"
          "## Boundaries"
          "âœ… **Always do:**"
          "âš ï¸ **Ask first:**"
          "ğŸš« **Never do:**"
        )
        
        for section in "${required_sections[@]}"; do
          if ! grep -Fq "$section" "${{ matrix.agent }}.md"; then
            echo "âŒ Missing required section: $section"
            exit 1
          fi
          echo "âœ… Found section: $section"
        done
        
        # Check for emoji in agent name
        if ! grep -q "ğŸ¤–\|ğŸ›¡ï¸\|âš¡\|ğŸŒ\|ğŸ§˜\|ğŸ”\|ğŸ¨\|ğŸ˜\|ğŸ³\|â˜¸ï¸\|ğŸ—„ï¸\|ğŸ”„\|ğŸ“Š\|ğŸ”Œ\|ğŸ“±\|ğŸ§ª" "${{ matrix.agent }}.md"; then
          echo "âš ï¸ Warning: Agent should have an emoji"
        else
          echo "âœ… Agent has emoji"
        fi
        
        # Check file size (should be substantial but not too large)
        file_size=$(wc -c < "${{ matrix.agent }}.md")
        if [ $file_size -lt 1000 ]; then
          echo "âš ï¸ Warning: Agent file seems too small ($file_size bytes)"
        elif [ $file_size -gt 50000 ]; then
          echo "âš ï¸ Warning: Agent file seems too large ($file_size bytes)"
        else
          echo "âœ… Agent file size is reasonable ($file_size bytes)"
        fi
        
        echo "ğŸ‰ ${{ matrix.agent }} agent validation completed!"

  validate-documentation:
    name: Validate Documentation
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ“š Check Documentation Files
      run: |
        echo "ğŸ“š Validating documentation..."
        
        # Check required documentation files
        required_docs=(
          "README.md"
          "CONTRIBUTING.md"
          "LICENSE"
        )
        
        for doc in "${required_docs[@]}"; do
          if [ ! -f "$doc" ]; then
            echo "âŒ Documentation file $doc not found"
            exit 1
          fi
          echo "âœ… Found documentation: $doc"
        done
        
        # Check docs directory
        if [ ! -d "docs" ]; then
          echo "âŒ docs directory not found"
          exit 1
        fi
        
        echo "âœ… docs directory exists"
        
        # Check required docs files
        required_docs_files=(
          "docs/AGENT_ARCHITECTURE.md"
          "docs/INTEGRATION_GUIDE.md"
          "docs/BEST_PRACTICES.md"
          "docs/FAQ.md"
        )
        
        for doc in "${required_docs_files[@]}"; do
          if [ ! -f "$doc" ]; then
            echo "âŒ Documentation file $doc not found"
            exit 1
          fi
          echo "âœ… Found documentation: $doc"
        done
        
        echo "ğŸ‰ Documentation validation completed!"

  check-links:
    name: Check Links
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ”— Check Markdown Links
      uses: gaurav-nelson/github-action-markdown-link-check@v1
      with:
        use-quiet-mode: 'yes'
        use-verbose-mode: 'yes'
        config-file: '.github/link-check-config.json'
      continue-on-error: true

  validate-templates:
    name: Validate GitHub Templates
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ“‹ Validate Issue Templates
      run: |
        echo "ğŸ“‹ Validating issue templates..."
        
        # Check issue template directory
        if [ ! -d ".github/ISSUE_TEMPLATE" ]; then
          echo "âŒ Issue template directory not found"
          exit 1
        fi
        
        echo "âœ… Issue template directory exists"
        
        # Check required templates
        required_templates=(
          ".github/ISSUE_TEMPLATE/bug_report.md"
          ".github/ISSUE_TEMPLATE/feature_request.md"
        )
        
        for template in "${required_templates[@]}"; do
          if [ ! -f "$template" ]; then
            echo "âŒ Template $template not found"
            exit 1
          fi
          echo "âœ… Found template: $template"
        done
        
        # Check PR template
        if [ ! -f ".github/PULL_REQUEST_TEMPLATE.md" ]; then
          echo "âŒ PR template not found"
          exit 1
        fi
        
        echo "âœ… PR template exists"
        
        # Validate template frontmatter
        for template in "${required_templates[@]}"; do
          if ! grep -q "^name:" "$template"; then
            echo "âŒ Template $template missing name field"
            exit 1
          fi
          echo "âœ… Template $template has name field"
        done
        
        echo "ğŸ‰ Template validation completed!"

  performance-check:
    name: Performance Check
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: âš¡ Check Repository Performance
      run: |
        echo "âš¡ Checking repository performance..."
        
        # Check repository size
        repo_size=$(du -sh . | cut -f1)
        echo "ğŸ“Š Repository size: $repo_size"
        
        # Count files
        file_count=$(find . -type f | wc -l)
        echo "ğŸ“Š Total files: $file_count"
        
        # Count agent files
        agent_count=$(ls -1 *.md 2>/dev/null | grep -E '^[A-Z]+\.md$' | wc -l)
        echo "ğŸ¤– Agent files: $agent_count"
        
        # Check for very large files
        large_files=$(find . -type f -size +1M -not -path './.git/*')
        if [ ! -z "$large_files" ]; then
          echo "âš ï¸ Warning: Large files found:"
          echo "$large_files"
        else
          echo "âœ… No large files found"
        fi
        
        echo "ğŸ‰ Performance check completed!"

  community-health:
    name: Community Health Check
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸŒŸ Check Community Features
      run: |
        echo "ğŸŒŸ Checking community features..."
        
        # Check for contributing guidelines
        if [ ! -f "CONTRIBUTING.md" ]; then
          echo "âŒ CONTRIBUTING.md not found"
          exit 1
        fi
        echo "âœ… Contributing guidelines exist"
        
        # Check for license
        if [ ! -f "LICENSE" ]; then
          echo "âŒ LICENSE not found"
          exit 1
        fi
        echo "âœ… License exists"
        
        # Check for code of conduct (optional but recommended)
        if [ -f "CODE_OF_CONDUCT.md" ]; then
          echo "âœ… Code of conduct exists"
        else
          echo "â„¹ï¸ Consider adding CODE_OF_CONDUCT.md"
        fi
        
        # Check for support documentation
        if [ -f "SUPPORT.md" ] || grep -q "support" README.md; then
          echo "âœ… Support information available"
        else
          echo "â„¹ï¸ Consider adding support information"
        fi
        
        echo "ğŸ‰ Community health check completed!"

  build-summary:
    name: Build Summary
    runs-on: ubuntu-latest
    needs: [validate-agents, validate-documentation, check-links, validate-templates, performance-check, community-health]
    if: always()
    
    steps:
    - name: ğŸ“Š Build Summary
      run: |
        echo "ğŸ¯ Autonomous Agents Repository Validation Summary"
        echo "=================================================="
        echo ""
        echo "ğŸ¤– Agent Validation: ${{ needs.validate-agents.result }}"
        echo "ğŸ“š Documentation: ${{ needs.validate-documentation.result }}"
        echo "ğŸ”— Link Check: ${{ needs.check-links.result }}"
        echo "ğŸ“‹ Templates: ${{ needs.validate-templates.result }}"
        echo "âš¡ Performance: ${{ needs.performance-check.result }}"
        echo "ğŸŒŸ Community Health: ${{ needs.community-health.result }}"
        echo ""
        
        # Overall status
        if [[ "${{ needs.validate-agents.result }}" == "success" && "${{ needs.validate-documentation.result }}" == "success" && "${{ needs.validate-templates.result }}" == "success" && "${{ needs.community-health.result }}" == "success" ]]; then
          echo "ğŸ‰ All critical checks passed! Repository is ready for public release."
        else
          echo "âš ï¸ Some checks failed. Please review and fix issues."
        fi
